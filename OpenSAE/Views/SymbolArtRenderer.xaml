<UserControl x:Class="OpenSAE.Views.SymbolArtRenderer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:models="clr-namespace:OpenSAE.Models"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=models:SymbolArtModel}"
             DataContextChanged="UserControl_DataContextChanged"
             x:Name="renderer"
             d:DesignHeight="550" d:DesignWidth="800">
    <UserControl.Resources>
        <DiffuseMaterial x:Key="borderMaterial">
            <DiffuseMaterial.Brush>
                <SolidColorBrush Color="Black" />
            </DiffuseMaterial.Brush>
        </DiffuseMaterial>
    </UserControl.Resources>
    <Grid>
        <Viewport3D>
            <ModelVisual3D>
                <ModelVisual3D.Content>
                    <!-- Group to which the symbol art layers are added-->
                    <Model3DGroup x:Name="symbolArtContentGroup" />
                </ModelVisual3D.Content>
            </ModelVisual3D>

            <ModelVisual3D>
                <ModelVisual3D.Content>
                    <!-- Group for displaying the currently selected layer -->
                    <Model3DGroup x:Name="selectedLayerContentGroup" />
                </ModelVisual3D.Content>
            </ModelVisual3D>

            <Viewport3D.Camera>
                <!-- 
                The camera is wider than the typical symbol art (192 units) 
                since it is nice to have a view of what is outside the active area
                -->
                <OrthographicCamera 
                Position="0.5 0.5 1"
                LookDirection="0 0 -1"
                UpDirection="0 1 0"
                Width="240"
                />
            </Viewport3D.Camera>
        </Viewport3D>
        <Viewbox Stretch="Uniform" VerticalAlignment="Stretch">
            <Canvas Width="192" Height="96" VerticalAlignment="Center" Margin="24 0" DataContext="{Binding ElementName=renderer, Path=SelectedLayer}" HorizontalAlignment="center">
                <!-- Highlight vertices of the current layer, if there is one -->
                <Polyline Points="{Binding Converter={StaticResource layerPointConverter}}"
                          Canvas.Left="96" Canvas.Top="48"  StrokeThickness="0.5" Stroke="White">
                </Polyline>
                <Polyline Points="{Binding Converter={StaticResource layerPointConverter}}"
                          Canvas.Left="96" Canvas.Top="48"  StrokeThickness="0.5" Stroke="Black" StrokeDashArray="0.25 0 0.25">
                </Polyline>

                <!-- Border framing active area of symbol art -->
                <Border BorderThickness="0.5" BorderBrush="Black" Width="192" Height="96" Opacity="0.7" />
            </Canvas>
        </Viewbox>
    </Grid>
</UserControl>
